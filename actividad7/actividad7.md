
# Completely Fair Scheduler (CFS)


**¿Qué es CFS?**
El Completely Fair Scheduler (CFS) es el programador de procesos por defecto en el núcleo de Linux desde su introducción en la versión 2.6.23. Su diseño se centra en proporcionar un reparto equitativo del tiempo de CPU entre todos los procesos, basándose en el principio de que cada tarea reciba una cantidad de tiempo proporcional a su peso o prioridad, lo que asegura que ningún proceso acapare el procesador en detrimento de otros.

El objetivo principal de CFS es imitar la multitarea perfecta en procesadores reales, asignando a cada tarea un "tiempo de ejecución virtual" que refleja cuánto tiempo ha estado en el procesador. Este enfoque permite que las tareas que han esperado más tiempo o que han utilizado menos tiempo de CPU sean priorizadas, fomentando así un entorno más eficiente y equitativo para la ejecución de procesos

El CFS reemplazó el modelo de planificación preemptiva clásica, que utilizaba tiempos de ejecución fijos y prioridades explícitas, por un sistema que calcula dinámicamente el tiempo de procesador para cada tarea según cambia el contexto de planificación. En lugar de trabajar con tiempos fijos, CFS aspira a imitar la multitarea perfecta, idealmente permitiendo que cada tarea en ejecución reciba una porción equitativa del poder de procesamiento. Se introduce un concepto denominado "latencia objetivo", que es el tiempo mínimo durante el cual se espera que cada tarea tenga al menos un turno en el procesador. El tiempo que cada tarea recibe se calcula dividiendo este valor entre el número de tareas en ejecución, ajustándose dinámicamente según las necesidades del sistema​.

**Principales Caracteristicas**

| Característica          | Descripción                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Objetivo**            | Proporcionar un reparto equitativo del tiempo de CPU entre todas las tareas, basándose en la justicia proporcional según el peso o prioridad de cada tarea.&#8203;``【oaicite:8】``&#8203;                                                                                                                                                                                                                                                                                                                          |
| **Modelo de Planificación** | Reemplaza el modelo de planificación preemptiva clásica con tiempos fijos por un sistema que calcula dinámicamente el tiempo de procesador para cada tarea.&#8203;``【oaicite:7】``&#8203;                                                                                                                                                                                                                                                                                                                        |
| **Latencia Objetivo**   | Es el tiempo mínimo durante el cual cada tarea debe tener al menos un turno en el procesador, con un valor predeterminado aproximado de 20ms. Esto se divide entre el número de tareas para calcular el tiempo asignado a cada una.&#8203;``【oaicite:6】``&#8203;                                                                                                                                                                                                                                               |
| **Virtual Runtime (vruntime)** | Cada tarea tiene un "tiempo de ejecución virtual" que mide cuánto tiempo ha estado en el procesador. CFS utiliza este valor para priorizar tareas que han utilizado menos tiempo de CPU.&#8203;``【oaicite:5】``&#8203;                                                                                                                                                                                                                                                                                            |
| **Estructura de Datos**  | A diferencia de lo que se creía anteriormente, CFS utiliza una lista de salto para sus operaciones internas, lo que permite inserciones, eliminaciones y búsquedas rápidas.&#8203;``【oaicite:4】``&#8203;                                                                                                                                                                                                                                                                                                          |
| **Agrupación Automática** | Introducida con un parche en 2010, mejora el rendimiento interactivo agrupando procesos padre e hijo en el mismo grupo de tareas, mejorando la respuesta en sistemas SMP al realizar tareas intensivas en CPU.&#8203;``【oaicite:3】``&#8203;                                                                                                                                                                                                                                                                     |
| **Soporte para SMP**    | CFS soporta procesamiento simétrico multi-núcleo (SMP), permitiendo que cualquier proceso (kernel o usuario) se ejecute en cualquier procesador. Además, admite la configuración de dominios de planificación para el balanceo de carga o segregación.&#8203;``【oaicite:2】``&#8203;                                                                                                                                                                                                                              |
| **Clases de Planificación** | Además de CFS (`SCHED_NORMAL`), Linux soporta clases de planificación para tareas en tiempo real, como `SCHED_FIFO` (primero en entrar, primero en salir) y `SCHED_RR` (round-robin), donde las tareas se ejecutan hasta completarse o hasta que agoten un tiempo fijo, respectivamente.&#8203;``【oaicite:1】``&#8203;                                                                                                                                                                                               |


**Funcionamiento del Completely Fair Scheduler (CFS)**

- **Justicia Proporcional**: CFS asigna el tiempo de CPU a las tareas basándose en una justicia proporcional a su peso o prioridad, buscando un reparto equitativo.
- **Cálculo Dinámico del Tiempo**: A diferencia de sistemas con tiempos fijos, CFS calcula de forma dinámica el tiempo que cada tarea debe ejecutarse, ajustándose a la carga de trabajo actual.
- **Tiempo de Ejecución Virtual (vruntime)**: Cada tarea tiene un vruntime que indica cuánto tiempo ha estado en el procesador. Las tareas con menor vruntime son priorizadas.
- **Distribución Equitativa del Tiempo de CPU**: CFS intenta asegurar que todas las tareas progresen de manera equitativa, distribuyendo el tiempo de procesador proporcionalmente.
- **Estructuras de Datos Avanzadas**: Utiliza estructuras como listas de salto para gestionar tareas eficientemente, permitiendo inserciones, eliminaciones y búsquedas rápidas.
- **Ajuste según la Carga de Trabajo**: Mediante parámetros como la latencia objetivo y la granularidad mínima, CFS se adapta a diversas cargas y entornos.



![Cómo funciona el mecanismo interno del SFC para elegir la siguiente tarea a ejecutar](https://miro.medium.com/v2/resize:fit:679/0*dQeVrjrbDOxDVzQw.gif)

